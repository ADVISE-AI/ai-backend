2025-09-13T16:47:24.662207425Z Using cached regex-2025.7.31-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (804 kB)
2025-09-13T16:47:24.664285136Z Using cached requests_oauthlib-2.0.0-py2.py3-none-any.whl (24 kB)
2025-09-13T16:47:24.66568456Z Using cached rich-14.1.0-py3-none-any.whl (243 kB)
2025-09-13T16:47:24.667647708Z Using cached rpds_py-0.26.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (385 kB)
2025-09-13T16:47:24.669888763Z Using cached shellingham-1.5.4-py2.py3-none-any.whl (9.8 kB)
2025-09-13T16:47:24.671135753Z Using cached six-1.17.0-py2.py3-none-any.whl (11 kB)
2025-09-13T16:47:24.672418214Z Using cached sniffio-1.3.1-py3-none-any.whl (10 kB)
2025-09-13T16:47:24.673784867Z Using cached stack_data-0.6.3-py3-none-any.whl (24 kB)
2025-09-13T16:47:24.675073199Z Using cached sympy-1.14.0-py3-none-any.whl (6.3 MB)
2025-09-13T16:47:24.681444104Z Using cached tokenizers-0.21.2-cp39-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.1 MB)
2025-09-13T16:47:24.684905949Z Using cached tqdm-4.67.1-py3-none-any.whl (78 kB)
2025-09-13T16:47:24.686454907Z Using cached traitlets-5.14.3-py3-none-any.whl (85 kB)
2025-09-13T16:47:24.68779802Z Using cached typer-0.16.0-py3-none-any.whl (46 kB)
2025-09-13T16:47:24.68903487Z Using cached typing_inspection-0.4.1-py3-none-any.whl (14 kB)
2025-09-13T16:47:24.690207838Z Using cached uvicorn-0.35.0-py3-none-any.whl (66 kB)
2025-09-13T16:47:24.69151013Z Using cached uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)
2025-09-13T16:47:24.69644164Z Using cached watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (451 kB)
2025-09-13T16:47:24.697995158Z Using cached wcwidth-0.2.13-py2.py3-none-any.whl (34 kB)
2025-09-13T16:47:24.699333871Z Using cached websocket_client-1.8.0-py3-none-any.whl (58 kB)
2025-09-13T16:47:24.701946365Z Using cached websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-09-13T16:47:24.703355419Z Using cached werkzeug-3.1.3-py3-none-any.whl (224 kB)
2025-09-13T16:47:24.70502004Z Using cached xxhash-3.5.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (194 kB)
2025-09-13T16:47:24.706336132Z Using cached zipp-3.23.0-py3-none-any.whl (10 kB)
2025-09-13T16:47:25.207801458Z Installing collected packages: wcwidth, PyPika, pure_eval, ptyprocess, mpmath, flatbuffers, filetype, durationpy, zstandard, zipp, xxhash, websockets, websocket-client, uvloop, urllib3, typing_extensions, traitlets, tqdm, tenacity, sympy, sniffio, six, shellingham, rpds-py, regex, PyYAML, python-dotenv, pyproject_hooks, Pygments, pybase64, pyasn1, psycopg2-binary, psycopg, protobuf, prompt_toolkit, pexpect, parso, packaging, overrides, ormsgpack, orjson, oauthlib, numpy, mmh3, mdurl, MarkupSafe, jsonpointer, jiter, itsdangerous, importlib_resources, idna, humanfriendly, httptools, hf-xet, h11, grpcio, greenlet, fsspec, filelock, executing, distro, decorator, click, charset-normalizer, certifi, cachetools, blinker, bcrypt, backoff, attrs, asttokens, asgiref, annotated-types, Werkzeug, uvicorn, typing-inspection, stack-data, SQLAlchemy, rsa, requests, referencing, python-dateutil, pydantic_core, pyasn1_modules, psycopg-pool, proto-plus, opentelemetry-proto, matplotlib-inline, markdown-it-py, jsonpatch, Jinja2, jedi, ipython_pygments_lexers, importlib_metadata, httpcore, gunicorn, googleapis-common-protos, faiss-cpu, coloredlogs, build, anyio, watchfiles, tiktoken, rich, requests-toolbelt, requests-oauthlib, pydantic, posthog, opentelemetry-exporter-otlp-proto-common, opentelemetry-api, onnxruntime, jsonschema-specifications, ipython, huggingface-hub, httpx, grpcio-status, google-auth, Flask, typer, tokenizers, opentelemetry-semantic-conventions, openai, langsmith, langgraph-sdk, kubernetes, jsonschema, google-api-core, opentelemetry-sdk, langchain-core, opentelemetry-exporter-otlp-proto-grpc, langgraph-checkpoint, langchain-text-splitters, langchain-openai, google-ai-generativelanguage, langgraph-prebuilt, langgraph-checkpoint-postgres, langchain-google-genai, langchain, chromadb, langgraph
2025-09-13T16:48:00.067224211Z 
2025-09-13T16:48:00.083925589Z Successfully installed Flask-3.1.1 Jinja2-3.1.6 MarkupSafe-3.0.2 PyPika-0.48.9 PyYAML-6.0.2 Pygments-2.19.2 SQLAlchemy-2.0.41 Werkzeug-3.1.3 annotated-types-0.7.0 anyio-4.9.0 asgiref-3.9.1 asttokens-3.0.0 attrs-25.3.0 backoff-2.2.1 bcrypt-4.3.0 blinker-1.9.0 build-1.2.2.post1 cachetools-5.5.2 certifi-2025.7.14 charset-normalizer-3.4.2 chromadb-1.0.15 click-8.2.1 coloredlogs-15.0.1 decorator-5.2.1 distro-1.9.0 durationpy-0.10 executing-2.2.1 faiss-cpu-1.11.0.post1 filelock-3.18.0 filetype-1.2.0 flatbuffers-25.2.10 fsspec-2025.7.0 google-ai-generativelanguage-0.6.18 google-api-core-2.25.1 google-auth-2.40.3 googleapis-common-protos-1.70.0 greenlet-3.2.3 grpcio-1.74.0 grpcio-status-1.74.0 gunicorn-23.0.0 h11-0.16.0 hf-xet-1.1.5 httpcore-1.0.9 httptools-0.6.4 httpx-0.28.1 huggingface-hub-0.34.1 humanfriendly-10.0 idna-3.10 importlib_metadata-8.7.0 importlib_resources-6.5.2 ipython-9.5.0 ipython_pygments_lexers-1.1.1 itsdangerous-2.2.0 jedi-0.19.2 jiter-0.10.0 jsonpatch-1.33 jsonpointer-3.0.0 jsonschema-4.25.0 jsonschema-specifications-2025.4.1 kubernetes-33.1.0 langchain-0.3.27 langchain-core-0.3.75 langchain-google-genai-2.1.10 langchain-openai-0.3.28 langchain-text-splitters-0.3.9 langgraph-0.6.1 langgraph-checkpoint-2.1.1 langgraph-checkpoint-postgres-2.0.23 langgraph-prebuilt-0.6.1 langgraph-sdk-0.2.0 langsmith-0.4.8 markdown-it-py-3.0.0 matplotlib-inline-0.1.7 mdurl-0.1.2 mmh3-5.1.0 mpmath-1.3.0 numpy-2.3.2 oauthlib-3.3.1 onnxruntime-1.22.1 openai-1.97.1 opentelemetry-api-1.35.0 opentelemetry-exporter-otlp-proto-common-1.35.0 opentelemetry-exporter-otlp-proto-grpc-1.35.0 opentelemetry-proto-1.35.0 opentelemetry-sdk-1.35.0 opentelemetry-semantic-conventions-0.56b0 orjson-3.11.1 ormsgpack-1.10.0 overrides-7.7.0 packaging-25.0 parso-0.8.5 pexpect-4.9.0 posthog-5.4.0 prompt_toolkit-3.0.52 proto-plus-1.26.1 protobuf-6.31.1 psycopg-3.2.9 psycopg-pool-3.2.6 psycopg2-binary-2.9.10 ptyprocess-0.7.0 pure_eval-0.2.3 pyasn1-0.6.1 pyasn1_modules-0.4.2 pybase64-1.4.1 pydantic-2.11.7 pydantic_core-2.33.2 pyproject_hooks-1.2.0 python-dateutil-2.9.0.post0 python-dotenv-1.1.1 referencing-0.36.2 regex-2025.7.31 requests-2.32.4 requests-oauthlib-2.0.0 requests-toolbelt-1.0.0 rich-14.1.0 rpds-py-0.26.0 rsa-4.9.1 shellingham-1.5.4 six-1.17.0 sniffio-1.3.1 stack-data-0.6.3 sympy-1.14.0 tenacity-9.1.2 tiktoken-0.9.0 tokenizers-0.21.2 tqdm-4.67.1 traitlets-5.14.3 typer-0.16.0 typing-inspection-0.4.1 typing_extensions-4.14.1 urllib3-2.5.0 uvicorn-0.35.0 uvloop-0.21.0 watchfiles-1.1.0 wcwidth-0.2.13 websocket-client-1.8.0 websockets-15.0.1 xxhash-3.5.0 zipp-3.23.0 zstandard-0.23.0
2025-09-13T16:48:00.096641469Z 
2025-09-13T16:48:00.096663479Z [notice] A new release of pip is available: 25.1.1 -> 25.2
2025-09-13T16:48:00.09666705Z [notice] To update, run: pip install --upgrade pip
2025-09-13T16:48:03.370574444Z ==> Uploading build...
2025-09-13T16:49:48.03160062Z ==> Uploaded in 100.6s. Compression took 4.1s
2025-09-13T16:49:48.100942773Z ==> Build successful ðŸŽ‰
2025-09-13T16:49:49.746503193Z ==> Deploying...
2025-09-13T16:50:19.585035596Z ==> Running 'gunicorn app:app'
2025-09-13T16:50:52.644857434Z 2025-09-13 16:50:52,644 INFO bot: Langgraph DB setup successfully
2025-09-13T16:50:56.220211765Z ==> No open ports detected, continuing to scan...
2025-09-13T16:50:56.299649739Z ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
2025-09-13T16:50:59.184000953Z [2025-09-13 16:50:59 +0000] [56] [INFO] Starting gunicorn 23.0.0
2025-09-13T16:50:59.184837264Z [2025-09-13 16:50:59 +0000] [56] [INFO] Listening at: http://0.0.0.0:10000 (56)
2025-09-13T16:50:59.184895815Z [2025-09-13 16:50:59 +0000] [56] [INFO] Using worker: sync
2025-09-13T16:50:59.27971948Z [2025-09-13 16:50:59 +0000] [74] [INFO] Booting worker with pid: 74
2025-09-13T16:51:00.070410267Z 127.0.0.1 - - [13/Sep/2025:16:51:00 +0000] "HEAD / HTTP/1.1" 404 0 "-" "Go-http-client/1.1"
2025-09-13T16:51:00.538952316Z ==> Your service is live ðŸŽ‰
2025-09-13T16:51:00.578334412Z ==> 
2025-09-13T16:51:00.61012724Z ==> ///////////////////////////////////////////////////////////
2025-09-13T16:51:00.643141227Z ==> 
2025-09-13T16:51:00.678556604Z ==> Available at your primary URL https://ai-backend-5tfs.onrender.com
2025-09-13T16:51:00.708734392Z ==> 
2025-09-13T16:51:00.73999625Z ==> ///////////////////////////////////////////////////////////
2025-09-13T16:51:01.794488899Z 127.0.0.1 - - [13/Sep/2025:16:51:01 +0000] "GET / HTTP/1.1" 404 207 "-" "Go-http-client/2.0"
2025-09-13T16:51:53.525036398Z 127.0.0.1 - - [13/Sep/2025:16:51:53 +0000] "GET / HTTP/1.1" 404 207 "-" "WhatsApp/2.23.20.0"
2025-09-13T16:54:24.450412568Z 127.0.0.1 - - [13/Sep/2025:16:54:24 +0000] "GET /?hub.mode=subscribe&hub.challenge=1887312402&hub.verify_token=b6b621d5075f38bbb759ac5c5d3eaea1d36ce20407de36d5864ad32daccd3081 HTTP/1.1" 404 207 "-" "facebookplatform/1.0 (+http://developers.facebook.com)"
2025-09-13T16:55:07.945167956Z 127.0.0.1 - - [13/Sep/2025:16:55:07 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T16:56:04.496037666Z ==> Detected service running on port 10000
2025-09-13T16:56:04.595295285Z ==> Docs on specifying a port: https://render.com/docs/web-services#port-binding
2025-09-13T17:01:47.692763385Z 2025-09-13 17:01:47,692 INFO bot: Message type: AIMessage
2025-09-13T17:01:53.292719015Z 2025-09-13 17:01:53,292 INFO httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-09-13T17:01:53.749917798Z 2025-09-13 17:01:53,749 INFO bot: Message type: AIMessage
2025-09-13T17:01:54.54386894Z 2025-09-13 17:01:54,543 INFO whatsapp: Typing indicator response: 200
2025-09-13T17:01:54.543901391Z 2025-09-13 17:01:54,543 INFO whatsapp: Typing indicator sent for message wamid.HBgMOTE3OTgwOTc3MzYxFQIAEhgWM0VCMDcwMjE3NTFFNjc4NjhGQTJGRAA=
2025-09-13T17:02:00.434676543Z 2025-09-13 17:02:00,434 INFO whatsapp: Message send response: 200
2025-09-13T17:02:00.434700324Z 2025-09-13 17:02:00,434 INFO whatsapp: Message sent successfully to 917980977361
2025-09-13T17:02:01.344511698Z 2025-09-13 17:02:01,344 INFO app: Response sent on Whatsapp.
2025-09-13T17:02:01.345085042Z === EXECUTING NODE: gemini ===
2025-09-13T17:02:01.345108032Z === EXECUTING NODE: tools ===
2025-09-13T17:02:01.345114003Z === EXECUTING NODE: gpt ===
2025-09-13T17:02:01.345119003Z === STREAM COMPLETED ===
2025-09-13T17:02:01.345124143Z 127.0.0.1 - - [13/Sep/2025:17:02:01 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:02:01.491864228Z 127.0.0.1 - - [13/Sep/2025:17:02:01 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:02:02.446664623Z 127.0.0.1 - - [13/Sep/2025:17:02:02 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:02:02.468885752Z 127.0.0.1 - - [13/Sep/2025:17:02:02 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:02:02.771886576Z 127.0.0.1 - - [13/Sep/2025:17:02:02 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:02:09.340209823Z 127.0.0.1 - - [13/Sep/2025:17:02:09 +0000] "POST /webhook HTTP/1.1" 200 2 "-" "facebookexternalua"
2025-09-13T17:05:02.232541202Z [2025-09-13 17:05:02 +0000] [56] [CRITICAL] WORKER TIMEOUT (pid:74)
2025-09-13T17:05:02.497907246Z [2025-09-13 17:05:02 +0000] [74] [ERROR] Error handling request /webhook
2025-09-13T17:05:02.497928136Z Traceback (most recent call last):
2025-09-13T17:05:02.497933306Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/gunicorn/workers/sync.py", line 134, in handle
2025-09-13T17:05:02.497938626Z     self.handle_request(listener, req, client, addr)
2025-09-13T17:05:02.497942646Z     ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.497957187Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/gunicorn/workers/sync.py", line 177, in handle_request
2025-09-13T17:05:02.497959857Z     respiter = self.wsgi(environ, resp.start_response)
2025-09-13T17:05:02.497962797Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1536, in __call__
2025-09-13T17:05:02.497965347Z     return self.wsgi_app(environ, start_response)
2025-09-13T17:05:02.497967847Z            ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.497970307Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:05:02.497972587Z     response = self.full_dispatch_request()
2025-09-13T17:05:02.497974987Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:05:02.497977517Z     rv = self.dispatch_request()
2025-09-13T17:05:02.497979898Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:05:02.497982078Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:05:02.497984227Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:05:02.497986618Z   File "/opt/render/project/src/app.py", line 125, in webhook
2025-09-13T17:05:02.497988798Z     respond_to_user(msg, user_ph, msg_id)
2025-09-13T17:05:02.497991218Z     ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.497993598Z   File "/opt/render/project/src/app.py", line 162, in respond_to_user
2025-09-13T17:05:02.497995948Z     ai_resp = stream_graph_updates(user_ph, user_input)
2025-09-13T17:05:02.497998208Z   File "/opt/render/project/src/bot.py", line 250, in stream_graph_updates
2025-09-13T17:05:02.498000708Z     for events in graph.stream(DEFAULT_STATE, config={"configurable": {"thread_id": user_ph}}):
2025-09-13T17:05:02.498003178Z                   ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498005728Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2648, in stream
2025-09-13T17:05:02.498008048Z     for _ in runner.tick(
2025-09-13T17:05:02.498010268Z              ~~~~~~~~~~~^
2025-09-13T17:05:02.498012818Z         [t for t in loop.tasks.values() if not t.writes],
2025-09-13T17:05:02.498015378Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498018758Z     ...<2 lines>...
2025-09-13T17:05:02.498021359Z         schedule_task=loop.accept_push,
2025-09-13T17:05:02.498023699Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498026119Z     ):
2025-09-13T17:05:02.498028519Z     ^
2025-09-13T17:05:02.498030889Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_runner.py", line 162, in tick
2025-09-13T17:05:02.498033899Z     run_with_retry(
2025-09-13T17:05:02.498036699Z     ~~~~~~~~~~~~~~^
2025-09-13T17:05:02.498039329Z         t,
2025-09-13T17:05:02.498041649Z         ^^
2025-09-13T17:05:02.498044059Z     ...<10 lines>...
2025-09-13T17:05:02.498046529Z         },
2025-09-13T17:05:02.498048599Z         ^^
2025-09-13T17:05:02.49806574Z     )
2025-09-13T17:05:02.49806823Z     ^
2025-09-13T17:05:02.49807089Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_retry.py", line 42, in run_with_retry
2025-09-13T17:05:02.49807346Z     return task.proc.invoke(task.input, config)
2025-09-13T17:05:02.49807568Z            ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.49808382Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/_internal/_runnable.py", line 646, in invoke
2025-09-13T17:05:02.49808618Z     input = context.run(step.invoke, input, config, **kwargs)
2025-09-13T17:05:02.49808878Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/_internal/_runnable.py", line 390, in invoke
2025-09-13T17:05:02.49809118Z     ret = self.func(*args, **kwargs)
2025-09-13T17:05:02.49809428Z   File "/opt/render/project/src/bot.py", line 151, in gemini_node
2025-09-13T17:05:02.49809698Z     ai_resp = gemini_agent.invoke({
2025-09-13T17:05:02.498099641Z         "system_message": GEMINI_SYSTEM_PROMPT,
2025-09-13T17:05:02.498101841Z     ...<3 lines>...
2025-09-13T17:05:02.49810427Z         "waiting_for_human_response": state.get("waiting_for_human_response"),
2025-09-13T17:05:02.498106401Z     })
2025-09-13T17:05:02.498108661Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 3082, in invoke
2025-09-13T17:05:02.498111311Z     input_ = context.run(step.invoke, input_, config)
2025-09-13T17:05:02.498113851Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5495, in invoke
2025-09-13T17:05:02.498116241Z     return self.bound.invoke(
2025-09-13T17:05:02.498118471Z            ~~~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.498120941Z         input,
2025-09-13T17:05:02.498123511Z         ^^^^^^
2025-09-13T17:05:02.498125811Z         self._merge_configs(config),
2025-09-13T17:05:02.498128141Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498130531Z         **{**self.kwargs, **kwargs},
2025-09-13T17:05:02.498132751Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498135241Z     )
2025-09-13T17:05:02.498137591Z     ^
2025-09-13T17:05:02.498139771Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 1490, in invoke
2025-09-13T17:05:02.498142151Z     return super().invoke(input, config, stop=stop, **kwargs)
2025-09-13T17:05:02.498144522Z            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498150222Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 393, in invoke
2025-09-13T17:05:02.498153112Z     self.generate_prompt(
2025-09-13T17:05:02.498155462Z     ~~~~~~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.498157872Z         [self._convert_input(input)],
2025-09-13T17:05:02.498160152Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498162432Z     ...<6 lines>...
2025-09-13T17:05:02.498164982Z         **kwargs,
2025-09-13T17:05:02.498167112Z         ^^^^^^^^^
2025-09-13T17:05:02.498169452Z     ).generations[0][0],
2025-09-13T17:05:02.498171822Z     ^
2025-09-13T17:05:02.498174002Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1019, in generate_prompt
2025-09-13T17:05:02.498176492Z     return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
2025-09-13T17:05:02.498178842Z            ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498181283Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 837, in generate
2025-09-13T17:05:02.498183472Z     self._generate_with_cache(
2025-09-13T17:05:02.498185892Z     ~~~~~~~~~~~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.498188183Z         m,
2025-09-13T17:05:02.498190513Z         ^^
2025-09-13T17:05:02.498197153Z     ...<2 lines>...
2025-09-13T17:05:02.498199643Z         **kwargs,
2025-09-13T17:05:02.498201853Z         ^^^^^^^^^
2025-09-13T17:05:02.498204243Z     )
2025-09-13T17:05:02.498206963Z     ^
2025-09-13T17:05:02.498209663Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1085, in _generate_with_cache
2025-09-13T17:05:02.498212123Z     result = self._generate(
2025-09-13T17:05:02.498214463Z         messages, stop=stop, run_manager=run_manager, **kwargs
2025-09-13T17:05:02.498216953Z     )
2025-09-13T17:05:02.498219343Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 1597, in _generate
2025-09-13T17:05:02.498221784Z     response: GenerateContentResponse = _chat_with_retry(
2025-09-13T17:05:02.498224293Z                                         ~~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.498226684Z         request=request,
2025-09-13T17:05:02.498229204Z         ^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498231574Z     ...<2 lines>...
2025-09-13T17:05:02.498233994Z         metadata=self.default_metadata,
2025-09-13T17:05:02.498236254Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.498238614Z     )
2025-09-13T17:05:02.498240854Z     ^
2025-09-13T17:05:02.498243504Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 247, in _chat_with_retry
2025-09-13T17:05:02.498246164Z     return _chat_with_retry(**params)
2025-09-13T17:05:02.498248834Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 338, in wrapped_f
2025-09-13T17:05:02.498251004Z     return copy(f, *args, **kw)
2025-09-13T17:05:02.498253114Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 477, in __call__
2025-09-13T17:05:02.498255444Z     do = self.iter(retry_state=retry_state)
2025-09-13T17:05:02.498257594Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 378, in iter
2025-09-13T17:05:02.498260124Z     result = action(retry_state)
2025-09-13T17:05:02.498262314Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 400, in <lambda>
2025-09-13T17:05:02.498264614Z     self._add_action_func(lambda rs: rs.outcome.result())
2025-09-13T17:05:02.498267005Z                                      ~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:02.498269275Z   File "/usr/local/lib/python3.13/concurrent/futures/_base.py", line 449, in result
2025-09-13T17:05:02.498271585Z     return self.__get_result()
2025-09-13T17:05:02.498274155Z            ~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:02.498276625Z   File "/usr/local/lib/python3.13/concurrent/futures/_base.py", line 401, in __get_result
2025-09-13T17:05:02.498278925Z     raise self._exception
2025-09-13T17:05:02.498281225Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/tenacity/__init__.py", line 480, in __call__
2025-09-13T17:05:02.498283535Z     result = fn(*args, **kwargs)
2025-09-13T17:05:02.498286015Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langchain_google_genai/chat_models.py", line 216, in _chat_with_retry
2025-09-13T17:05:02.498288605Z     return generation_method(**kwargs)
2025-09-13T17:05:02.498291465Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 868, in generate_content
2025-09-13T17:05:02.498293715Z     response = rpc(
2025-09-13T17:05:02.498296085Z         request,
2025-09-13T17:05:02.498298455Z     ...<2 lines>...
2025-09-13T17:05:02.498309126Z         metadata=metadata,
2025-09-13T17:05:02.498311716Z     )
2025-09-13T17:05:02.498314186Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
2025-09-13T17:05:02.498316626Z     return wrapped_func(*args, **kwargs)
2025-09-13T17:05:02.498318906Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
2025-09-13T17:05:02.498321436Z     return retry_target(
2025-09-13T17:05:02.498323836Z         target,
2025-09-13T17:05:02.498326106Z     ...<3 lines>...
2025-09-13T17:05:02.498328676Z         on_error=on_error,
2025-09-13T17:05:02.498330966Z     )
2025-09-13T17:05:02.498333306Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
2025-09-13T17:05:02.498335926Z     result = target()
2025-09-13T17:05:02.498338196Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
2025-09-13T17:05:02.499045404Z     return func(*args, **kwargs)
2025-09-13T17:05:02.499057854Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/api_core/grpc_helpers.py", line 76, in error_remapped_callable
2025-09-13T17:05:02.499060954Z     return callable_(*args, **kwargs)
2025-09-13T17:05:02.499063754Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/grpc/_interceptor.py", line 277, in __call__
2025-09-13T17:05:02.499066174Z     response, ignored_call = self._with_call(
2025-09-13T17:05:02.499068624Z                              ~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.499070845Z         request,
2025-09-13T17:05:02.499073274Z         ^^^^^^^^
2025-09-13T17:05:02.499075605Z     ...<4 lines>...
2025-09-13T17:05:02.499078215Z         compression=compression,
2025-09-13T17:05:02.499080945Z         ^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.499083535Z     )
2025-09-13T17:05:02.499085755Z     ^
2025-09-13T17:05:02.499088455Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/grpc/_interceptor.py", line 329, in _with_call
2025-09-13T17:05:02.499091145Z     call = self._interceptor.intercept_unary_unary(
2025-09-13T17:05:02.499093485Z         continuation, client_call_details, request
2025-09-13T17:05:02.499095705Z     )
2025-09-13T17:05:02.499098345Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/transports/grpc.py", line 78, in intercept_unary_unary
2025-09-13T17:05:02.499100915Z     response = continuation(client_call_details, request)
2025-09-13T17:05:02.499103195Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/grpc/_interceptor.py", line 315, in continuation
2025-09-13T17:05:02.499105465Z     response, call = self._thunk(new_method).with_call(
2025-09-13T17:05:02.499107725Z                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
2025-09-13T17:05:02.499109905Z         request,
2025-09-13T17:05:02.499112366Z         ^^^^^^^^
2025-09-13T17:05:02.499114606Z     ...<4 lines>...
2025-09-13T17:05:02.499116826Z         compression=new_compression,
2025-09-13T17:05:02.499119206Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.499121336Z     )
2025-09-13T17:05:02.499123746Z     ^
2025-09-13T17:05:02.499126006Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/grpc/_channel.py", line 1189, in with_call
2025-09-13T17:05:02.499128406Z     state, call = self._blocking(
2025-09-13T17:05:02.499130756Z                   ~~~~~~~~~~~~~~^
2025-09-13T17:05:02.499133056Z         request, timeout, metadata, credentials, wait_for_ready, compression
2025-09-13T17:05:02.499143816Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:02.499146246Z     )
2025-09-13T17:05:02.499148676Z     ^
2025-09-13T17:05:02.499151096Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/grpc/_channel.py", line 1162, in _blocking
2025-09-13T17:05:02.499153616Z     event = call.next_event()
2025-09-13T17:05:02.499156107Z   File "src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi", line 388, in grpc._cython.cygrpc.SegregatedCall.next_event
2025-09-13T17:05:02.499158516Z   File "src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi", line 211, in grpc._cython.cygrpc._next_call_event
2025-09-13T17:05:02.499160617Z   File "src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi", line 205, in grpc._cython.cygrpc._next_call_event
2025-09-13T17:05:02.499162777Z   File "src/python/grpcio/grpc/_cython/_cygrpc/completion_queue.pyx.pxi", line 97, in grpc._cython.cygrpc._latent_event
2025-09-13T17:05:02.499165287Z   File "src/python/grpcio/grpc/_cython/_cygrpc/completion_queue.pyx.pxi", line 80, in grpc._cython.cygrpc._internal_latent_event
2025-09-13T17:05:02.499167677Z   File "src/python/grpcio/grpc/_cython/_cygrpc/completion_queue.pyx.pxi", line 61, in grpc._cython.cygrpc._next
2025-09-13T17:05:02.499170387Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/gunicorn/workers/base.py", line 204, in handle_abort
2025-09-13T17:05:02.499172837Z     sys.exit(1)
2025-09-13T17:05:02.499175257Z     ~~~~~~~~^^^
2025-09-13T17:05:02.499177697Z SystemExit: 1
2025-09-13T17:05:02.499794982Z [2025-09-13 17:05:02 +0000] [74] [INFO] Worker exiting (pid: 74)
2025-09-13T17:05:02.500640433Z 127.0.0.1 - - [13/Sep/2025:17:05:02 +0000] "POST /webhook HTTP/1.1" 500 0 "-" "-"
2025-09-13T17:05:03.375647193Z [2025-09-13 17:05:03 +0000] [56] [ERROR] Worker (pid:74) was sent SIGKILL! Perhaps out of memory?
2025-09-13T17:05:03.385829165Z [2025-09-13 17:05:03 +0000] [107] [INFO] Booting worker with pid: 107
2025-09-13T17:05:03.718023669Z 2025-09-13 17:05:03,717 ERROR app: Database insert failed (inbound): (psycopg2.OperationalError) SSL error: decryption failed or bad record mac
2025-09-13T17:05:03.718038809Z 
2025-09-13T17:05:03.718042729Z [SQL: SELECT conversation.id 
2025-09-13T17:05:03.718045889Z FROM conversation 
2025-09-13T17:05:03.718057709Z WHERE conversation.phone = %(phone_1)s]
2025-09-13T17:05:03.71806031Z [parameters: {'phone_1': '917980977361'}]
2025-09-13T17:05:03.71806321Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-13T17:05:03.732057765Z 2025-09-13 17:05:03,718 ERROR app: Exception on /webhook [POST]
2025-09-13T17:05:03.732071505Z Traceback (most recent call last):
2025-09-13T17:05:03.732076246Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:05:03.732078986Z     response = self.full_dispatch_request()
2025-09-13T17:05:03.732083406Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
2025-09-13T17:05:03.732085976Z     rv = self.handle_user_exception(e)
2025-09-13T17:05:03.732088266Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:05:03.732091616Z     rv = self.dispatch_request()
2025-09-13T17:05:03.732094026Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:05:03.732096356Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:05:03.732099426Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:05:03.732111117Z   File "/opt/render/project/src/app.py", line 65, in webhook
2025-09-13T17:05:03.732114077Z     with engine.begin() as conn:
2025-09-13T17:05:03.732117037Z          ~~~~~~~~~~~~^^
2025-09-13T17:05:03.732119727Z   File "/usr/local/lib/python3.13/contextlib.py", line 148, in __exit__
2025-09-13T17:05:03.732122267Z     next(self.gen)
2025-09-13T17:05:03.732124827Z     ~~~~^^^^^^^^^^
2025-09-13T17:05:03.732127557Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 3238, in begin
2025-09-13T17:05:03.732130117Z     with conn.begin():
2025-09-13T17:05:03.732132757Z          ~~~~~~~~~~^^
2025-09-13T17:05:03.732135337Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/util.py", line 147, in __exit__
2025-09-13T17:05:03.732138007Z     with util.safe_reraise():
2025-09-13T17:05:03.732140477Z          ~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732143117Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
2025-09-13T17:05:03.732145557Z     raise exc_value.with_traceback(exc_tb)
2025-09-13T17:05:03.732148147Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/util.py", line 145, in __exit__
2025-09-13T17:05:03.732150638Z     self.commit()
2025-09-13T17:05:03.732152967Z     ~~~~~~~~~~~^^
2025-09-13T17:05:03.732155407Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2628, in commit
2025-09-13T17:05:03.732157908Z     self._do_commit()
2025-09-13T17:05:03.732160328Z     ~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732162878Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2733, in _do_commit
2025-09-13T17:05:03.732165278Z     self._connection_commit_impl()
2025-09-13T17:05:03.732167708Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732170898Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2704, in _connection_commit_impl
2025-09-13T17:05:03.732173218Z     self.connection._commit_impl()
2025-09-13T17:05:03.732175428Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732177588Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1143, in _commit_impl
2025-09-13T17:05:03.732179748Z     self._handle_dbapi_exception(e, None, None, None, None)
2025-09-13T17:05:03.732182078Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:03.732184568Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2354, in _handle_dbapi_exception
2025-09-13T17:05:03.732187168Z     raise exc_info[1].with_traceback(exc_info[2])
2025-09-13T17:05:03.732189548Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1141, in _commit_impl
2025-09-13T17:05:03.732192079Z     self.engine.dialect.do_commit(self.connection)
2025-09-13T17:05:03.732194499Z                                   ^^^^^^^^^^^^^^^
2025-09-13T17:05:03.732196788Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 583, in connection
2025-09-13T17:05:03.732199319Z     return self._revalidate_connection()
2025-09-13T17:05:03.732201989Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732204929Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 675, in _revalidate_connection
2025-09-13T17:05:03.732207469Z     self._invalid_transaction()
2025-09-13T17:05:03.732215159Z     ~~~~~~~~~~~~~~~~~~~~~~~~~^^
2025-09-13T17:05:03.732217799Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 665, in _invalid_transaction
2025-09-13T17:05:03.732220259Z     raise exc.PendingRollbackError(
2025-09-13T17:05:03.732222739Z     ...<4 lines>...
2025-09-13T17:05:03.732225119Z     )
2025-09-13T17:05:03.732228919Z sqlalchemy.exc.PendingRollbackError: Can't reconnect until invalid transaction is rolled back.  Please rollback() fully before proceeding (Background on this error at: https://sqlalche.me/e/20/8s2b)
2025-09-13T17:05:03.736089445Z 127.0.0.1 - - [13/Sep/2025:17:05:03 +0000] "POST /webhook HTTP/1.1" 500 265 "-" "facebookexternalua"
2025-09-13T17:05:06.736828073Z 2025-09-13 17:05:06,736 WARNING psycopg.pool: discarding closed connection: <psycopg.Connection [BAD] at 0x72a950fdf4d0>
2025-09-13T17:05:06.742482122Z 2025-09-13 17:05:06,736 ERROR app: Exception on /webhook [POST]
2025-09-13T17:05:06.742495033Z Traceback (most recent call last):
2025-09-13T17:05:06.742499153Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:05:06.742501933Z     response = self.full_dispatch_request()
2025-09-13T17:05:06.742505543Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
2025-09-13T17:05:06.742508273Z     rv = self.handle_user_exception(e)
2025-09-13T17:05:06.742511073Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:05:06.742514823Z     rv = self.dispatch_request()
2025-09-13T17:05:06.742517483Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:05:06.742520313Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:05:06.742523893Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:05:06.742526563Z   File "/opt/render/project/src/app.py", line 125, in webhook
2025-09-13T17:05:06.742529064Z     respond_to_user(msg, user_ph, msg_id)
2025-09-13T17:05:06.742531693Z     ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:06.742534444Z   File "/opt/render/project/src/app.py", line 162, in respond_to_user
2025-09-13T17:05:06.742537184Z     ai_resp = stream_graph_updates(user_ph, user_input)
2025-09-13T17:05:06.742540094Z   File "/opt/render/project/src/bot.py", line 250, in stream_graph_updates
2025-09-13T17:05:06.742543404Z     for events in graph.stream(DEFAULT_STATE, config={"configurable": {"thread_id": user_ph}}):
2025-09-13T17:05:06.742546074Z                   ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:06.742548694Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2583, in stream
2025-09-13T17:05:06.742552114Z     with SyncPregelLoop(
2025-09-13T17:05:06.742554954Z          ~~~~~~~~~~~~~~^
2025-09-13T17:05:06.742557564Z         input,
2025-09-13T17:05:06.742560154Z         ^^^^^^
2025-09-13T17:05:06.742562764Z     ...<17 lines>...
2025-09-13T17:05:06.742565314Z         cache_policy=self.cache_policy,
2025-09-13T17:05:06.742568145Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:06.742570685Z     ) as loop:
2025-09-13T17:05:06.742573474Z     ^
2025-09-13T17:05:06.742576135Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_loop.py", line 1002, in __enter__
2025-09-13T17:05:06.742599025Z     saved = self.checkpointer.get_tuple(self.checkpoint_config)
2025-09-13T17:05:06.742617326Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 227, in get_tuple
2025-09-13T17:05:06.742620296Z     cur.execute(
2025-09-13T17:05:06.742622976Z     ~~~~~~~~~~~^
2025-09-13T17:05:06.742625736Z         self.SELECT_SQL + where,
2025-09-13T17:05:06.742628376Z         ^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:06.742630776Z         args,
2025-09-13T17:05:06.742633106Z         ^^^^^
2025-09-13T17:05:06.742635736Z     )
2025-09-13T17:05:06.742638396Z     ^
2025-09-13T17:05:06.742641226Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg/cursor.py", line 97, in execute
2025-09-13T17:05:06.742643826Z     raise ex.with_traceback(None)
2025-09-13T17:05:06.742646486Z psycopg.OperationalError: consuming input failed: SSL error: decryption failed or bad record mac
2025-09-13T17:05:06.74279547Z 127.0.0.1 - - [13/Sep/2025:17:05:06 +0000] "POST /webhook HTTP/1.1" 500 265 "-" "facebookexternalua"
2025-09-13T17:05:18.473777773Z 2025-09-13 17:05:18,442 ERROR app: Exception on /webhook [POST]
2025-09-13T17:05:18.473803604Z Traceback (most recent call last):
2025-09-13T17:05:18.473810174Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:05:18.473815224Z     response = self.full_dispatch_request()
2025-09-13T17:05:18.473820664Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
2025-09-13T17:05:18.473825294Z     rv = self.handle_user_exception(e)
2025-09-13T17:05:18.473830034Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:05:18.473835094Z     rv = self.dispatch_request()
2025-09-13T17:05:18.473839964Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:05:18.473844545Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:05:18.473849985Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:05:18.473854575Z   File "/opt/render/project/src/app.py", line 125, in webhook
2025-09-13T17:05:18.473859085Z     respond_to_user(msg, user_ph, msg_id)
2025-09-13T17:05:18.473864025Z     ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:18.473868915Z   File "/opt/render/project/src/app.py", line 162, in respond_to_user
2025-09-13T17:05:18.473873545Z     ai_resp = stream_graph_updates(user_ph, user_input)
2025-09-13T17:05:18.473878415Z   File "/opt/render/project/src/bot.py", line 250, in stream_graph_updates
2025-09-13T17:05:18.473883615Z     for events in graph.stream(DEFAULT_STATE, config={"configurable": {"thread_id": user_ph}}):
2025-09-13T17:05:18.473888675Z                   ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:18.473893536Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2583, in stream
2025-09-13T17:05:18.473898796Z     with SyncPregelLoop(
2025-09-13T17:05:18.473903666Z          ~~~~~~~~~~~~~~^
2025-09-13T17:05:18.473909346Z         input,
2025-09-13T17:05:18.473915086Z         ^^^^^^
2025-09-13T17:05:18.473919486Z     ...<17 lines>...
2025-09-13T17:05:18.473923016Z         cache_policy=self.cache_policy,
2025-09-13T17:05:18.473926456Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:18.473929876Z     ) as loop:
2025-09-13T17:05:18.473933367Z     ^
2025-09-13T17:05:18.473937017Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_loop.py", line 1002, in __enter__
2025-09-13T17:05:18.473949717Z     saved = self.checkpointer.get_tuple(self.checkpoint_config)
2025-09-13T17:05:18.473953927Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 226, in get_tuple
2025-09-13T17:05:18.473956107Z     with self._cursor() as cur:
2025-09-13T17:05:18.473958217Z          ~~~~~~~~~~~~^^
2025-09-13T17:05:18.473960317Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:18.473962397Z     return next(self.gen)
2025-09-13T17:05:18.473964537Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 402, in _cursor
2025-09-13T17:05:18.473966808Z     with self.lock, _internal.get_connection(self.conn) as conn:
2025-09-13T17:05:18.473969028Z                     ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
2025-09-13T17:05:18.473971148Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:18.473973218Z     return next(self.gen)
2025-09-13T17:05:18.473975318Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/_internal.py", line 19, in get_connection
2025-09-13T17:05:18.473977428Z     with conn.connection() as conn:
2025-09-13T17:05:18.473979508Z          ~~~~~~~~~~~~~~~^^
2025-09-13T17:05:18.473981648Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:18.473983708Z     return next(self.gen)
2025-09-13T17:05:18.473985848Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 169, in connection
2025-09-13T17:05:18.473987938Z     conn = self.getconn(timeout=timeout)
2025-09-13T17:05:18.473990028Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 203, in getconn
2025-09-13T17:05:18.473992088Z     raise PoolTimeout(
2025-09-13T17:05:18.473994278Z         f"couldn't get a connection after {timeout:.2f} sec"
2025-09-13T17:05:18.473996438Z     ) from None
2025-09-13T17:05:18.473998588Z psycopg_pool.PoolTimeout: couldn't get a connection after 10.00 sec
2025-09-13T17:05:18.474320486Z 127.0.0.1 - - [13/Sep/2025:17:05:18 +0000] "POST /webhook HTTP/1.1" 500 265 "-" "facebookexternalua"
2025-09-13T17:05:45.863145528Z 2025-09-13 17:05:45,860 ERROR app: Exception on /webhook [POST]
2025-09-13T17:05:45.863176419Z Traceback (most recent call last):
2025-09-13T17:05:45.863184279Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:05:45.863188389Z     response = self.full_dispatch_request()
2025-09-13T17:05:45.863192449Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
2025-09-13T17:05:45.863196049Z     rv = self.handle_user_exception(e)
2025-09-13T17:05:45.863200229Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:05:45.863204479Z     rv = self.dispatch_request()
2025-09-13T17:05:45.86320817Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:05:45.863211919Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:05:45.86321811Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:05:45.86322173Z   File "/opt/render/project/src/app.py", line 125, in webhook
2025-09-13T17:05:45.86322545Z     respond_to_user(msg, user_ph, msg_id)
2025-09-13T17:05:45.86322905Z     ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:45.86324448Z   File "/opt/render/project/src/app.py", line 162, in respond_to_user
2025-09-13T17:05:45.8632471Z     ai_resp = stream_graph_updates(user_ph, user_input)
2025-09-13T17:05:45.863249451Z   File "/opt/render/project/src/bot.py", line 250, in stream_graph_updates
2025-09-13T17:05:45.863252131Z     for events in graph.stream(DEFAULT_STATE, config={"configurable": {"thread_id": user_ph}}):
2025-09-13T17:05:45.863254321Z                   ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:45.863256621Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2583, in stream
2025-09-13T17:05:45.863259071Z     with SyncPregelLoop(
2025-09-13T17:05:45.863261381Z          ~~~~~~~~~~~~~~^
2025-09-13T17:05:45.863263591Z         input,
2025-09-13T17:05:45.863265581Z         ^^^^^^
2025-09-13T17:05:45.863267571Z     ...<17 lines>...
2025-09-13T17:05:45.863269711Z         cache_policy=self.cache_policy,
2025-09-13T17:05:45.863271651Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:05:45.863273571Z     ) as loop:
2025-09-13T17:05:45.863275601Z     ^
2025-09-13T17:05:45.863277701Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_loop.py", line 1002, in __enter__
2025-09-13T17:05:45.863279791Z     saved = self.checkpointer.get_tuple(self.checkpoint_config)
2025-09-13T17:05:45.863282451Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 226, in get_tuple
2025-09-13T17:05:45.863284511Z     with self._cursor() as cur:
2025-09-13T17:05:45.863286492Z          ~~~~~~~~~~~~^^
2025-09-13T17:05:45.863288572Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:45.863290612Z     return next(self.gen)
2025-09-13T17:05:45.863292612Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 402, in _cursor
2025-09-13T17:05:45.863295102Z     with self.lock, _internal.get_connection(self.conn) as conn:
2025-09-13T17:05:45.863297192Z                     ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
2025-09-13T17:05:45.863299252Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:45.863301252Z     return next(self.gen)
2025-09-13T17:05:45.863303362Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/_internal.py", line 19, in get_connection
2025-09-13T17:05:45.863305352Z     with conn.connection() as conn:
2025-09-13T17:05:45.863307422Z          ~~~~~~~~~~~~~~~^^
2025-09-13T17:05:45.863309482Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:05:45.863311482Z     return next(self.gen)
2025-09-13T17:05:45.863313592Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 169, in connection
2025-09-13T17:05:45.863315702Z     conn = self.getconn(timeout=timeout)
2025-09-13T17:05:45.863317862Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 203, in getconn
2025-09-13T17:05:45.863319892Z     raise PoolTimeout(
2025-09-13T17:05:45.863321852Z         f"couldn't get a connection after {timeout:.2f} sec"
2025-09-13T17:05:45.863323832Z     ) from None
2025-09-13T17:05:45.863325902Z psycopg_pool.PoolTimeout: couldn't get a connection after 10.00 sec
2025-09-13T17:05:45.86363098Z 127.0.0.1 - - [13/Sep/2025:17:05:45 +0000] "POST /webhook HTTP/1.1" 500 265 "-" "facebookexternalua"
2025-09-13T17:07:46.647628878Z 2025-09-13 17:07:46,644 ERROR app: Exception on /webhook [POST]
2025-09-13T17:07:46.647657329Z Traceback (most recent call last):
2025-09-13T17:07:46.64767613Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
2025-09-13T17:07:46.64767884Z     response = self.full_dispatch_request()
2025-09-13T17:07:46.64768168Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
2025-09-13T17:07:46.64768392Z     rv = self.handle_user_exception(e)
2025-09-13T17:07:46.64768602Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
2025-09-13T17:07:46.64768872Z     rv = self.dispatch_request()
2025-09-13T17:07:46.64769114Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
2025-09-13T17:07:46.64769358Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-09-13T17:07:46.64769605Z            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
2025-09-13T17:07:46.64769809Z   File "/opt/render/project/src/app.py", line 125, in webhook
2025-09-13T17:07:46.6477001Z     respond_to_user(msg, user_ph, msg_id)
2025-09-13T17:07:46.64770215Z     ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:07:46.64770434Z   File "/opt/render/project/src/app.py", line 162, in respond_to_user
2025-09-13T17:07:46.647706351Z     ai_resp = stream_graph_updates(user_ph, user_input)
2025-09-13T17:07:46.647708331Z   File "/opt/render/project/src/bot.py", line 250, in stream_graph_updates
2025-09-13T17:07:46.64771096Z     for events in graph.stream(DEFAULT_STATE, config={"configurable": {"thread_id": user_ph}}):
2025-09-13T17:07:46.647713061Z                   ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:07:46.647715221Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/main.py", line 2583, in stream
2025-09-13T17:07:46.647718091Z     with SyncPregelLoop(
2025-09-13T17:07:46.647720111Z          ~~~~~~~~~~~~~~^
2025-09-13T17:07:46.647722071Z         input,
2025-09-13T17:07:46.647724191Z         ^^^^^^
2025-09-13T17:07:46.647726261Z     ...<17 lines>...
2025-09-13T17:07:46.647728501Z         cache_policy=self.cache_policy,
2025-09-13T17:07:46.647730531Z         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-09-13T17:07:46.647733031Z     ) as loop:
2025-09-13T17:07:46.647735081Z     ^
2025-09-13T17:07:46.647737271Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/pregel/_loop.py", line 1002, in __enter__
2025-09-13T17:07:46.647739381Z     saved = self.checkpointer.get_tuple(self.checkpoint_config)
2025-09-13T17:07:46.647741811Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 226, in get_tuple
2025-09-13T17:07:46.647743831Z     with self._cursor() as cur:
2025-09-13T17:07:46.647745901Z          ~~~~~~~~~~~~^^
2025-09-13T17:07:46.647748001Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:07:46.647750072Z     return next(self.gen)
2025-09-13T17:07:46.647752112Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/__init__.py", line 402, in _cursor
2025-09-13T17:07:46.647754222Z     with self.lock, _internal.get_connection(self.conn) as conn:
2025-09-13T17:07:46.647756212Z                     ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
2025-09-13T17:07:46.647758332Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:07:46.647760412Z     return next(self.gen)
2025-09-13T17:07:46.647762522Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/langgraph/checkpoint/postgres/_internal.py", line 19, in get_connection
2025-09-13T17:07:46.647769512Z     with conn.connection() as conn:
2025-09-13T17:07:46.647771852Z          ~~~~~~~~~~~~~~~^^
2025-09-13T17:07:46.647773992Z   File "/usr/local/lib/python3.13/contextlib.py", line 141, in __enter__
2025-09-13T17:07:46.647776202Z     return next(self.gen)
2025-09-13T17:07:46.647778332Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 169, in connection
2025-09-13T17:07:46.647780422Z     conn = self.getconn(timeout=timeout)
2025-09-13T17:07:46.647782512Z   File "/opt/render/project/src/.venv/lib/python3.13/site-packages/psycopg_pool/pool.py", line 203, in getconn
2025-09-13T17:07:46.647784492Z     raise PoolTimeout(
2025-09-13T17:07:46.647786513Z         f"couldn't get a connection after {timeout:.2f} sec"
2025-09-13T17:07:46.647788653Z     ) from None
2025-09-13T17:07:46.647790762Z psycopg_pool.PoolTimeout: couldn't get a connection after 10.00 sec
2025-09-13T17:07:46.648140051Z 127.0.0.1 - - [13/Sep/2025:17:07:46 +0000] "POST /webhook HTTP/1.1" 500 265 "-" "facebookexternalua"
